{% extends "layout.html" %}
{% block body %}

  {% if 'session_key' not in session %}
  <div class="jumbotron">
    <h1>Weather by me</h1>
    <p class="lead">
        Join weather by me today!
    </p>
    <p><a class="btn btn-lg btn-success" href="{{ url_for('signup_page') }}" role="button">Sign Up</a></p>
  </div>
  {% endif %}

  <div class="modal fade" id='add-reply-modal'>
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Add Comment</h4>
        </div>
        <div class="modal-body">
         <textarea class="form-control" rows="4"></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="send-reply">Send</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->


  <div class="row">
    <div class="col-lg-6">
      <div id="card1" class="card" >
        <div class="card-component card-profile-container img-circle"></div>
        <img src="../static/img/profiles/yuna.png" class="img-circle card-component card-profile" style=""/>
        <div class="horizontal-divider card-component card-divider"></div>
        <div class="card-component card-title">Photo by Yuna Kim</div>
        <div class="card-component card-time">2 hours ago</div>
        <img class="card-image" id="card-image1" src="../static/img/posts/a.png"/>
        <div class="pull-left card-replies-link card-component" id="1">comments</div>
        <div class="pull-right card-reply-link card-component" id="add-reply1" data-toggle="modal" data-target="#add-reply-modal">add comment</div>
      </div>
    </div>
  </div>


{% endblock %}

{% block script %}
<script src="/static/js/feed_controller.js"></script>
<script>
$(document).ready(function() {
  top.feedController = new FeedController();
  feedController.init();
  top.commentsMap = {};
  function initialize(res, data) {
    for (i = 0; i < data.length; i++) {
      var post = data[i];
      var title = post['text'];
      var id = post['post_id'];
      var image = post['image'];
      var name = post['author']['name'];
      var pic = post['author']['pic'];
      var commentsLength = post['comments'].length
      var created_at = post['created_at']

      var div = top.feedController.getCard(id, pic, title, name, image, commentsLength);
      $('.container').append(div);

      var comments = post['comments']
      var commentsList = [];
      for (t = 0; t < comments.length; t++) {
        var comment = comments[t];
        l.push({
            'profile_url' : comment['author']['pic'],
            'name' : comment['author']['name'],
            'reply' : comment['text']
        });
      }
      top.commentsMap[i] = l;
    }
  }
  /*
  top.repliesMap = {
    '1': [{'profile_url' : "../static/img/profiles/yuna2.png", 'name': 'yuna2', 'reply': 'Lorem ipsum dolor sit amet, consectetur adipisicing elit dolor sit amet, consectetur adipisicing elit dolor sit amet, consectetur adipisicing elit dolor sit amet, consectetur adipisicing elit'}, {'profile_url' : "../static/img/profiles/yuna3.png", 'name': 'yuna3', 'reply': 'Lorem ipsum dolor sit amet, consectetur'}]
  }
  */
  for (key in top.repliesMap) {
    $('#' + key).html(top.repliesMap[key].length + " comments");
  }

  
});
</script>
{% endblock %}
